version: '3.8'

services:
  matrix-messaging-mcp:
    build: .
    container_name: matrix-messaging-mcp
    restart: unless-stopped
    
    environment:
      # Matrix Configuration
      MATRIX_HOMESERVER_URL: ${MATRIX_HOMESERVER_URL:-https://matrix.oculair.ca}
      MATRIX_ADMIN_TOKEN: ${MATRIX_ADMIN_TOKEN}
      
      # MCP Server Configuration  
      PORT: ${MCP_SERVER_PORT:-3100}
      
      # Storage
      DATA_DIR: /app/data
      
      # Logging
      LOG_LEVEL: ${LOG_LEVEL:-info}
      
      # Optional: Letta Integration
      LETTA_API_URL: ${LETTA_API_URL:-}
      LETTA_API_TOKEN: ${LETTA_API_TOKEN:-}
    
    ports:
      - "${MCP_SERVER_PORT:-3100}:3100"
    
    volumes:
      # Persistent data storage
      - ./data:/app/data
      # Optional: Mount client storage separately
      - ./data/clients:/app/data/clients
    
    networks:
      - matrix-mcp-net
    
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3100/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  matrix-mcp-net:
    driver: bridge
