{"id":"matrix-synapse-deployment-02b","title":"Implement Docling API client for document conversion","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T06:43:52.233025211Z","updated_at":"2026-01-04T01:23:51.053844453Z","closed_at":"2026-01-04T01:23:51.053844453Z","close_reason":"Closed"}
{"id":"matrix-synapse-deployment-03ey","title":"Add OCR support for scanned PDFs and images","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T12:10:14.464430245Z","updated_at":"2026-01-04T01:23:50.191013091Z","closed_at":"2026-01-04T01:23:50.191013091Z","close_reason":"Closed","comments":[{"id":224,"issue_id":"matrix-synapse-deployment-03ey","author":"root","text":"## Objective\n\nEnable OCR extraction for scanned documents and images.\n\n## Implementation\n\n1. Detect if PDF is scanned (no selectable text)\n2. Enable OCR in Docling request for images (PNG, JPG)\n3. Handle mixed documents (some pages scanned, some not)\n\n## Supported Formats\n\n- Scanned PDFs\n- PNG images\n- JPG/JPEG images\n\n## Acceptance Criteria\n\n- [ ] OCR extracts text from scanned PDFs\n- [ ] Images converted to searchable Markdown\n- [ ] OCR accuracy \u003e 95% for clear scans\n- [ ] Processing time \u003c 30s for typical 10-page document\n\n---\nHuly Issue: MXSYN-11","created_at":"2026-01-02T12:10:14Z"}]}
{"id":"matrix-synapse-deployment-057m","title":"[BLOCKER] Expose Docling API port in docker-compose","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T15:58:02.156405404Z","updated_at":"2026-01-04T01:23:53.442081509Z","closed_at":"2026-01-04T01:23:53.442081509Z","close_reason":"Closed","comments":[{"id":347,"issue_id":"matrix-synapse-deployment-057m","author":"root","text":"## Problem - RESOLVED âœ…\n\nThe Docling container is now running with exposed ports.\n\n## Current Status\n\n- **API**: http://192.168.50.90:3057/docs (Swagger UI)\n- **Flower Monitoring**: http://192.168.50.90:3058\n- **Services**: 5 containers (API, Redis, 2 workers, Flower)\n- **Stack**: \n\n## Next Steps\n\n- [ ] Test API endpoint with sample PDF\n- [ ] Document authentication method (if any)\n- [ ] Verify Markdown output format\n\n## Related\n\n- MXSYN-2: Clarify Docling API specifications\n\n---\nHuly Issue: MXSYN-1","created_at":"2026-01-02T15:58:02Z"}]}
{"id":"matrix-synapse-deployment-08w4","title":"Add support for DOCX and PPTX formats","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T17:59:12.783364326Z","updated_at":"2026-01-04T01:23:54.511279201Z","closed_at":"2026-01-04T01:23:54.511279201Z","close_reason":"Closed","comments":[{"id":446,"issue_id":"matrix-synapse-deployment-08w4","author":"root","text":"## Objective\n\nExtend document processing to support Microsoft Office formats.\n\n## Supported Formats\n\n- DOCX (Word documents)\n- PPTX (PowerPoint presentations)\n- TXT (plain text)\n- MD (Markdown passthrough)\n\n## Implementation\n\n1. Detect file type from mimetype/extension\n2. Send to Docling for conversion\n3. Handle multi-slide PPTX appropriately\n\n## Acceptance Criteria\n\n- [ ] DOCX converted to Markdown with formatting preserved\n- [ ] PPTX slides converted to structured Markdown\n- [ ] Plain text files handled correctly\n\n---\nHuly Issue: MXSYN-12","created_at":"2026-01-02T17:59:13Z"}]}
{"id":"matrix-synapse-deployment-0ac","title":"Implement Letta file upload with metadata","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:30.792089571Z","updated_at":"2026-01-04T01:24:03.517547417Z","closed_at":"2026-01-04T01:24:03.517547417Z","close_reason":"Closed"}
{"id":"matrix-synapse-deployment-0h2r","title":"Clarify Docling API specifications","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T12:27:40.897871726Z","updated_at":"2026-01-04T01:23:52.34504372Z","closed_at":"2026-01-04T01:23:52.34504372Z","close_reason":"Closed","comments":[{"id":234,"issue_id":"matrix-synapse-deployment-0h2r","author":"root","text":"## Objective\n\nDocument the exact Docling REST API interface for integration.\n\n## Known Information âœ…\n\n- **API URL**: http://192.168.50.90:3057\n- **Swagger Docs**: http://192.168.50.90:3057/docs\n- **Flower Monitoring**: http://192.168.50.90:3058\n- **Architecture**: Celery-based async processing (Redis + 2 workers)\n\n## Questions to Answer\n\n1. **Endpoint Path**: What is the conversion endpoint? (? ?)\n2. **Authentication**: API key? Bearer token? None?\n3. **Request Format**: Multipart form-data or base64 JSON?\n4. **Response Format**: Confirm Markdown output structure\n5. **Async Processing**: How to poll for job completion?\n6. **File Size Limits**: Maximum supported file size?\n\n## Deliverable\n\n- [ ] Test API with sample PDF via Swagger UI\n- [ ] Document request/response format\n- [ ] Create code example for integration\n\n---\nHuly Issue: MXSYN-2","created_at":"2026-01-02T12:27:41Z"}]}
{"id":"matrix-synapse-deployment-0sn","title":"Documentation and examples for file upload integration","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:33.655745143Z","updated_at":"2026-01-04T01:23:17.097336037Z","closed_at":"2026-01-04T01:23:17.097336037Z","close_reason":"Closed","comments":[{"id":13,"issue_id":"matrix-synapse-deployment-0sn","author":"node","text":"## Objective\n\nCreate comprehensive documentation for the file upload feature.\n\n## Documentation\n\n1. **User Guide**: How to use file upload feature\n2. **Admin Guide**: Configuration and deployment\n3. **API Reference**: Docling and Letta API usage\n4. **Troubleshooting**: Common issues and solutions\n\n## Examples\n\n- Sample Python client for testing\n- curl commands for API testing\n- Configuration templates\n\n## Location\n\n- BookStack: Letta Integration book\n- Project README\n\n## Acceptance Criteria\n\n- [ ] User-facing documentation complete\n- [ ] Admin deployment guide\n- [ ] Code examples working\n- [ ] Troubleshooting guide\n\n---\nHuly Issue: MXSYN-18","created_at":"2025-12-22T23:46:33Z"}]}
{"id":"matrix-synapse-deployment-0wa2","title":"Add processing progress updates in Matrix","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T17:08:16.59674728Z","updated_at":"2026-01-04T01:23:55.623033342Z","closed_at":"2026-01-04T01:23:55.623033342Z","close_reason":"Closed","comments":[{"id":408,"issue_id":"matrix-synapse-deployment-0wa2","author":"root","text":"Synced from Beads: matrix-synapse-deployment-69x\n\n---\nHuly Issue: MXSYN-49","created_at":"2026-01-02T17:08:16Z"}]}
{"id":"matrix-synapse-deployment-0wi","title":"Deploy MCP Agent Mail server on port 8766","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T01:21:55.421766152Z","updated_at":"2026-01-04T01:23:41.127166804Z","closed_at":"2026-01-04T01:23:41.127166804Z","close_reason":"Closed","comments":[{"id":61,"issue_id":"matrix-synapse-deployment-0wi","author":"root","text":"Complete Docker build and deploy MCP Agent Mail as Layer 2 coordination system.\n\n## Tasks\n\n- Complete Docker compose build (already started)\n- Configure compose.yaml for port 8766\n- Start container and verify health\n- Configure .env for coordination mode (disable messaging features)\n- Test basic MCP HTTP endpoint\n\n## Success Criteria\n\n- Container running and healthy\n- Health endpoint responds: {\"detail\":\"Not Found\"}\n- Bearer token configured and working\n\n## Context\n\nMCP Agent Mail provides platform integrations and file reservations that Matrix doesn't handle. See docs/MCP_AGENT_MAIL_REEVALUATION.md\n\n---\nHuly Issue: MXSYN-51","created_at":"2026-01-02T01:21:55Z"}]}
{"id":"matrix-synapse-deployment-10d2","title":"Phase 2: Integrate Streaming into Matrix Client","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T21:48:39.425724265Z","updated_at":"2026-01-04T01:23:58.80962716Z","closed_at":"2026-01-04T01:23:58.80962716Z","close_reason":"Closed","dependencies":[{"issue_id":"matrix-synapse-deployment-10d2","depends_on_id":"matrix-synapse-deployment-2lx","type":"parent-child","created_at":"2026-01-04T01:08:32.997662085Z","created_by":"unknown"}],"comments":[{"id":539,"issue_id":"matrix-synapse-deployment-10d2","author":"root","text":"Synced from Beads: matrix-synapse-deployment-9zx\n\n---\nHuly Issue: MXSYN-46","created_at":"2026-01-02T21:48:39Z"}]}
{"id":"matrix-synapse-deployment-10nf","title":"Phase 1: Implement Step Streaming Adapter","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T20:14:27.806334437Z","updated_at":"2026-01-04T01:24:00.548655569Z","closed_at":"2026-01-04T01:24:00.548655569Z","close_reason":"Closed","dependencies":[{"issue_id":"matrix-synapse-deployment-10nf","depends_on_id":"matrix-synapse-deployment-2lx","type":"parent-child","created_at":"2026-01-04T01:08:33.329953759Z","created_by":"unknown"}],"comments":[{"id":490,"issue_id":"matrix-synapse-deployment-10nf","author":"root","text":"Synced from Beads: matrix-synapse-deployment-q53\n\n---\nHuly Issue: MXSYN-90","created_at":"2026-01-02T20:14:28Z"}]}
{"id":"matrix-synapse-deployment-1cd","title":"Implement retry logic for failed conversions","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:32.703293485Z","updated_at":"2025-12-22T23:46:32.703293485Z","comments":[{"id":7,"issue_id":"matrix-synapse-deployment-1cd","author":"node","text":"## Objective\n\nAdd robust error handling and retry logic for document processing.\n\n## Implementation\n\n1. Retry failed Docling requests (max 3 attempts)\n2. Exponential backoff between retries\n3. Queue failed jobs for later retry\n4. Alert on persistent failures\n\n## Error Scenarios\n\n- Docling service unavailable\n- Timeout on large documents\n- Corrupt/invalid file format\n- Rate limiting\n\n## Acceptance Criteria\n\n- [ ] Transient failures auto-retry\n- [ ] Persistent failures logged and alerted\n- [ ] User notified of final failure status\n- [ ] Failed jobs can be manually retried\n\n---\nHuly Issue: MXSYN-13","created_at":"2025-12-22T23:46:32Z"}]}
{"id":"matrix-synapse-deployment-1dr","title":"Testing: Streaming Unit and Integration Tests","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:31.545776647Z","updated_at":"2026-01-04T01:23:57.711681437Z","closed_at":"2026-01-04T01:23:57.711681437Z","close_reason":"Closed","dependencies":[{"issue_id":"matrix-synapse-deployment-1dr","depends_on_id":"matrix-synapse-deployment-2lx","type":"parent-child","created_at":"2026-01-04T01:08:32.691544884Z","created_by":"unknown"}],"comments":[{"id":2,"issue_id":"matrix-synapse-deployment-1dr","author":"node","text":"# Streaming Tests\n\n## Unit Tests\n\n### \n\n- [ ] Test  initialization\n- [ ] Test event parsing for each message type\n- [ ] Test error handling (timeout, connection error)\n- [ ] Test message normalization\n- [ ] Mock Letta SDK stream responses\n\n### Test Cases\n\n\n\n## Integration Tests\n\n### \n\n- [ ] Real streaming against test agent\n- [ ] Long-running operation with background mode\n- [ ] Connection recovery simulation\n- [ ] Multi-step tool chain streaming\n\n### Test Scenarios\n\n1. Simple prompt â†’ Single assistant response\n2. Search prompt â†’ tool_call â†’ tool_return â†’ assistant\n3. Complex prompt â†’ Multiple tool calls â†’ Multiple returns â†’ assistant\n4. Error scenario â†’ LLM error â†’ Graceful failure\n5. Long operation â†’ Background mode â†’ Recovery\n\n## Manual Testing Checklist\n\n- [ ] Basic message in Matrix triggers streaming\n- [ ] Tool progress visible during execution\n- [ ] Final response correct\n- [ ] No duplicate messages\n- [ ] Error messages clear\n- [ ] Works with different agents\n- [ ] Fallback works when streaming disabled\n\n## Test Data\n\n- Simple agent without tools\n- Agent with conversation_search tool\n- Agent with multiple tools\n- Agent with long-running tools\n\n---\nHuly Issue: MXSYN-25","created_at":"2025-12-22T23:46:31Z"}]}
{"id":"matrix-synapse-deployment-1tus","title":"Implement Matrix notification for processing status","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-03T02:37:41.678917197Z","updated_at":"2026-01-04T01:24:01.881045942Z","closed_at":"2026-01-04T01:24:01.881045942Z","close_reason":"Closed","comments":[{"id":628,"issue_id":"matrix-synapse-deployment-1tus","author":"root","text":"Synced from Beads: matrix-synapse-deployment-5e5\n\n---\nHuly Issue: MXSYN-89","created_at":"2026-01-03T02:37:42Z"}]}
{"id":"matrix-synapse-deployment-231j","title":"Add unit tests for external source audit posting","description":"## Context\nWhen a webhook arrives for an agent with no tracked Matrix conversation (CLI/API call), the handler should post an audit message.\n\n## Requirements\n- Test that handleRunCompleted() posts audit when no conversation is tracked (source: external)\n- Test that audit message format is correct (emoji, truncation, etc.)\n- Mock Matrix client to verify postSilentAudit is called\n\n## Files\n- mcp-servers/matrix-identity-bridge/src/core/letta-webhook-handler.ts\n- mcp-servers/matrix-identity-bridge/tests/webhook-audit-skip.test.ts","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T20:43:03.57044743-05:00","updated_at":"2026-01-02T20:43:03.57044743-05:00","labels":["test"]}
{"id":"matrix-synapse-deployment-2cy","title":"Refactor client.py: Extract LettaCode module","description":"client.py is 2078 lines with multiple concerns. Extract these modules:\n\n1. **LettaCode API** (~243 lines) - src/letta/code_api.py\n   - handle_letta_code_command()\n   - call_letta_code_api()\n   - run_letta_code_task()\n   - LettaCodeApiError class\n   - State management functions\n\n2. **Agent Operations** (~155 lines) - src/matrix/agent_ops.py\n   - delete_message_as_agent()\n   - set_typing_as_agent()\n   - send_as_agent()\n   - send_as_agent_with_event_id()\n\n3. **Callbacks** (~415 lines) - src/matrix/callbacks.py\n   - message_callback()\n   - file_callback()\n\n4. **Room Utilities** (~88 lines) - src/matrix/room_utils.py\n   - create_room_if_needed()\n   - join_room_if_needed()\n\nThis would reduce client.py to ~1200 lines of core message routing logic.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T13:11:29.195268835-05:00","updated_at":"2025-12-28T13:11:43.954316671-05:00"}
{"id":"matrix-synapse-deployment-2hpw","title":"Phase 3: Refactor ResponseMonitor for webhook-first","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T16:32:53.375873113Z","updated_at":"2026-01-02T16:32:53.375873113Z","dependencies":[{"issue_id":"matrix-synapse-deployment-2hpw","depends_on_id":"matrix-synapse-deployment-lg0a","type":"parent-child","created_at":"2026-01-02T16:32:53.715103514Z","created_by":"unknown"}],"comments":[{"id":364,"issue_id":"matrix-synapse-deployment-2hpw","author":"root","text":"1. Keep polling as fallback for agents without webhooks\n2. Add webhookEnabled flag to conversation tracking\n3. When webhook received, cancel any active polling\n4. Eventually deprecate polling entirely\n\n---\nHuly Issue: MXSYN-95","created_at":"2026-01-02T16:32:53Z"}]}
{"id":"matrix-synapse-deployment-2lx","title":"Implement Letta Streaming for Matrix Client","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:31.451589806Z","updated_at":"2026-01-04T01:23:56.404161731Z","closed_at":"2026-01-04T01:23:56.404161731Z","close_reason":"Closed"}
{"id":"matrix-synapse-deployment-3162","title":"Implement Matrix file download from media repository","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-03T04:13:37.447774879Z","updated_at":"2026-01-03T06:33:50.894201229Z","comments":[{"id":690,"issue_id":"matrix-synapse-deployment-3162","author":"root","text":"Synced from Beads: matrix-synapse-deployment-lxg\n\n---\nHuly Issue: MXSYN-39","created_at":"2026-01-03T04:13:37Z"}]}
{"id":"matrix-synapse-deployment-3bj","title":"Add processing progress updates in Matrix","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:25.571581913Z","updated_at":"2026-01-03T11:10:03.447798373-05:00","closed_at":"2026-01-03T11:10:03.447798373-05:00","close_reason":"Duplicate of matrix-synapse-deployment-0wa2","dependencies":[{"issue_id":"matrix-synapse-deployment-3bj","depends_on_id":"matrix-synapse-deployment-0wa2","type":"related","created_at":"2026-01-03T11:10:03.450183192-05:00","created_by":"root"}],"comments":[{"id":17,"issue_id":"matrix-synapse-deployment-3bj","author":"node","text":"## Objective\n\nProvide real-time progress updates for large document processing.\n\n## Implementation\n\n1. Send \"Processing started\" message immediately\n2. Update with progress for multi-page documents\n3. Send completion message with stats\n\n## Message Flow\n\n\n\n## Acceptance Criteria\n\n- [ ] Immediate acknowledgment of upload\n- [ ] Progress updates for large files (\u003e10 pages)\n- [ ] Final status with processing stats\n\n---\nHuly Issue: MXSYN-14","created_at":"2025-12-23T03:23:25Z"}]}
{"id":"matrix-synapse-deployment-3g1","title":"Reconcile Matrix user ID formats between matrix-client and identity-bridge","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T08:54:55.173180692Z","updated_at":"2025-12-28T08:54:55.173180692Z"}
{"id":"matrix-synapse-deployment-3ow","title":"Implement Matrix notification for processing status","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:30.231888535Z","updated_at":"2026-01-03T11:10:03.03402729-05:00","closed_at":"2026-01-03T11:10:03.03402729-05:00","close_reason":"Duplicate of matrix-synapse-deployment-1tus","dependencies":[{"issue_id":"matrix-synapse-deployment-3ow","depends_on_id":"matrix-synapse-deployment-1tus","type":"related","created_at":"2026-01-03T11:10:03.036457195-05:00","created_by":"root"}],"comments":[{"id":20,"issue_id":"matrix-synapse-deployment-3ow","author":"node","text":"## Objective\n\nNotify users in Matrix when file processing completes or fails.\n\n## Implementation\n\n1. Send success message: \n2. Send error message: \n3. Optional: Send progress updates for large files\n\n## Message Format\n\n\n\n## Error Format\n\n\n\n## Acceptance Criteria\n\n- [ ] Success notification sent to room\n- [ ] Error notification with helpful message\n- [ ] Messages formatted cleanly\n\n---\nHuly Issue: MXSYN-9","created_at":"2025-12-23T03:23:30Z"}]}
{"id":"matrix-synapse-deployment-3sf","title":"Add user configuration options for file processing","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-26T18:43:34.909909262Z","updated_at":"2025-12-26T18:43:34.909909262Z","comments":[{"id":39,"issue_id":"matrix-synapse-deployment-3sf","author":"node","text":"## Objective\n\nAllow users to configure file processing preferences.\n\n## Configuration Options\n\n1. **Auto-process**: Enable/disable automatic processing (opt-in)\n2. **Notifications**: Always / Errors only / Never\n3. **File types**: Which types to process\n4. **Privacy**: Mark files as \"do not index\"\n\n## Implementation\n\n- Room-level settings via Matrix state events\n- User preferences via bot commands\n- Default configuration in environment\n\n## Commands\n\n\n\n## Acceptance Criteria\n\n- [ ] Room-level configuration works\n- [ ] User preferences respected\n- [ ] Defaults are sensible (opt-in recommended)\n\n---\nHuly Issue: MXSYN-17","created_at":"2025-12-26T18:43:35Z"}]}
{"id":"matrix-synapse-deployment-48r","title":"[BLOCKER] Expose Docling API port in docker-compose","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:33.464412291Z","updated_at":"2026-01-03T11:10:03.714929406-05:00","closed_at":"2026-01-03T11:10:03.714929406-05:00","close_reason":"Duplicate of matrix-synapse-deployment-057m","dependencies":[{"issue_id":"matrix-synapse-deployment-48r","depends_on_id":"matrix-synapse-deployment-057m","type":"related","created_at":"2026-01-03T11:10:03.735919973-05:00","created_by":"root"}],"comments":[{"id":12,"issue_id":"matrix-synapse-deployment-48r","author":"node","text":"## Problem - RESOLVED âœ…\n\nThe Docling container is now running with exposed ports.\n\n## Current Status\n\n- **API**: http://192.168.50.90:3057/docs (Swagger UI)\n- **Flower Monitoring**: http://192.168.50.90:3058\n- **Services**: 5 containers (API, Redis, 2 workers, Flower)\n- **Stack**: \n\n## Next Steps\n\n- [ ] Test API endpoint with sample PDF\n- [ ] Document authentication method (if any)\n- [ ] Verify Markdown output format\n\n## Related\n\n- MXSYN-2: Clarify Docling API specifications\n\n---\nHuly Issue: MXSYN-1","created_at":"2025-12-22T23:46:33Z"}]}
{"id":"matrix-synapse-deployment-4esm","title":"Implement Letta folder management for Matrix rooms","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-03T03:42:17.932144524Z","updated_at":"2026-01-04T01:24:05.12090491Z","closed_at":"2026-01-04T01:24:05.12090491Z","close_reason":"Closed","comments":[{"id":667,"issue_id":"matrix-synapse-deployment-4esm","author":"root","text":"Synced from Beads: matrix-synapse-deployment-hjn\n\n---\nHuly Issue: MXSYN-40","created_at":"2026-01-03T03:42:18Z"}]}
{"id":"matrix-synapse-deployment-4hj","title":"Add environment configuration for file upload integration","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:33.599676036Z","updated_at":"2025-12-22T23:46:33.599676036Z"}
{"id":"matrix-synapse-deployment-4lp","title":"Create Matrix notification helpers for file reservations","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-26T18:45:11.005484264Z","updated_at":"2025-12-26T18:45:11.005484264Z"}
{"id":"matrix-synapse-deployment-4lpt","title":"Implement Matrix file upload event detection","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T20:20:06.999524385Z","updated_at":"2026-01-04T01:24:07.972549006Z","closed_at":"2026-01-04T01:24:07.972549006Z","close_reason":"Closed","comments":[{"id":502,"issue_id":"matrix-synapse-deployment-4lpt","author":"root","text":"Synced from Beads: matrix-synapse-deployment-uoo\n\n---\nHuly Issue: MXSYN-38","created_at":"2026-01-02T20:20:07Z"}]}
{"id":"matrix-synapse-deployment-4u8","title":"Test end-to-end multi-agent file coordination","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T18:45:11.664643447Z","updated_at":"2025-12-26T18:45:11.664643447Z","comments":[{"id":43,"issue_id":"matrix-synapse-deployment-4u8","author":"node","text":"Comprehensive testing of the three-layer architecture with real agent workflows.\n\n## Test Scenarios\n\n1. **Scenario 1: Successful Reservation**\n   - OpenCode agent reserves \n   - Letta agent checks for conflicts â†’ sees reservation\n   - Letta agent picks different file\n   - Both complete work without conflicts\n2. **Scenario 2: Pre-commit Guard**\n   - Agent A reserves file\n   - Agent B tries to commit changes to same file\n   - Pre-commit guard blocks commit\n   - Agent B sees clear error message\n3. **Scenario 3: Matrix Notifications**\n   - Agent reserves files\n   - Reservation appears in Matrix room\n   - Human sees notification in Element\n   - Agent releases â†’ release notification appears\n4. **Scenario 4: Huly Integration**\n   - Agent reserves files with reason=MXSYN-XXX\n   - Reservation linked to Huly issue\n   - Audit trail shows issue context\n\n## Success Criteria\n\n- All scenarios pass\n- Zero file conflicts\n- Clear visibility in Matrix\n- Pre-commit guards work correctly\n\n## Parent\n\nBlocked by: Document MCP Agent Mail integration\n\n---\nHuly Issue: MXSYN-56","created_at":"2025-12-26T18:45:11Z"}]}
{"id":"matrix-synapse-deployment-4xn","title":"Add monitoring and alerting for file processing","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-26T18:43:45.052948157Z","updated_at":"2025-12-26T18:43:45.052948157Z","comments":[{"id":40,"issue_id":"matrix-synapse-deployment-4xn","author":"node","text":"## Objective\n\nImplement observability for the file processing pipeline.\n\n## Metrics to Track\n\n- Files processed (daily/weekly)\n- Processing time distribution\n- Error rate by file type\n- Queue depth (pending files)\n- Docling worker health\n\n## Monitoring Stack\n\n- Flower UI for Celery monitoring (http://192.168.50.90:3058)\n- Custom metrics endpoint\n- Alert on high error rate or queue backup\n\n## Acceptance Criteria\n\n- [ ] Dashboard showing key metrics\n- [ ] Alerts for failures \u003e 5%\n- [ ] Alerts for queue \u003e 10 items\n- [ ] Historical data retention\n\n---\nHuly Issue: MXSYN-16","created_at":"2025-12-26T18:43:45Z"}]}
{"id":"matrix-synapse-deployment-4y6","title":"Performance optimization for document processing","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:33.92327493Z","updated_at":"2026-01-04T01:23:21.380995127Z","closed_at":"2026-01-04T01:23:21.380995127Z","close_reason":"Closed","comments":[{"id":16,"issue_id":"matrix-synapse-deployment-4y6","author":"node","text":"## Objective\n\nOptimize processing pipeline for speed and resource efficiency.\n\n## Optimizations\n\n1. Parallel processing for multiple uploads\n2. Caching for repeated document uploads\n3. Optimize Docling worker configuration\n4. Stream large files instead of loading to memory\n\n## Targets\n\n- Processing time \u003c 30s for 10-page PDF\n- Support 5+ concurrent conversions\n- Memory usage \u003c 500MB per conversion\n\n## Acceptance Criteria\n\n- [ ] Benchmark current performance\n- [ ] Implement optimizations\n- [ ] Verify targets met\n- [ ] Document configuration tuning\n\n---\nHuly Issue: MXSYN-15","created_at":"2025-12-22T23:46:33Z"}]}
{"id":"matrix-synapse-deployment-55s","title":"Create script to provision rooms for all agents on-demand","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T08:53:22.586055518Z","updated_at":"2026-01-04T01:23:13.126422126Z","closed_at":"2026-01-04T01:23:13.126422126Z","close_reason":"Closed"}
{"id":"matrix-synapse-deployment-5lo","title":"Add periodic health check for agent room provisioning","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T08:52:33.57782466Z","updated_at":"2025-12-28T08:52:33.57782466Z"}
{"id":"matrix-synapse-deployment-5rx","title":"Phase 4: Investigate Token Streaming (Deferred)","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:31.885102366Z","updated_at":"2026-01-04T01:23:18.409163825Z","closed_at":"2026-01-04T01:23:18.409163825Z","close_reason":"Closed","dependencies":[{"issue_id":"matrix-synapse-deployment-5rx","depends_on_id":"matrix-synapse-deployment-2lx","type":"parent-child","created_at":"2026-01-04T01:08:31.13906777Z","created_by":"unknown"}],"comments":[{"id":3,"issue_id":"matrix-synapse-deployment-5rx","author":"node","text":"# Token Streaming Investigation\n\n## Status: DEFERRED\n\nToken streaming () is currently not returning content chunks from the Letta server.\n\n## Current Behavior\n\nWhen :\n\n- Only  and  events received\n- No  or  chunks\n- Same behavior on direct API (port 8283) and proxy (port 8289)\n\n## Expected Behavior (per Letta docs)\n\nShould receive multiple chunks with same message ID:\n\n\n\n## Investigation Tasks\n\n- [ ] Test with different agents/models (GPT-4o, Gemini)\n- [ ] Check Letta server version\n- [ ] Review server logs for errors\n- [ ] Test on Letta Cloud vs self-hosted\n- [ ] Check if Claude Sonnet 4 supports token streaming via Letta\n\n## Potential Causes\n\n1. **Model limitation**: Claude Sonnet 4 may not support token streaming through Letta\n2. **Server configuration**: Token streaming may need to be enabled\n3. **Agent configuration**: May need specific agent settings\n4. **SDK version**: May need SDK update\n\n## Impact if Not Fixed\n\n- Step streaming provides adequate UX for most use cases\n- Token streaming mainly improves perceived latency\n- Not blocking for MVP\n\n## References\n\n- Letta docs: https://docs.letta.com/guides/agents/streaming/\n- Test script: \n\n---\nHuly Issue: MXSYN-24","created_at":"2025-12-22T23:46:31Z"}]}
{"id":"matrix-synapse-deployment-5tq","title":"Integrate MCP Agent Mail with OpenCode CLI","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T18:45:14.902110108Z","updated_at":"2025-12-26T18:45:14.902110108Z","comments":[{"id":46,"issue_id":"matrix-synapse-deployment-5tq","author":"node","text":"Configure OpenCode to use MCP Agent Mail for file coordination and async messaging.\n\n## Tasks\n\n- Run integration script: \n- Update opencode.json with MCP server config\n- Add bearer token authentication\n- Test file reservation tools from OpenCode\n- Document agent workflow\n\n## Tools Available After Integration\n\n-  - Reserve files before editing\n-  - Async coordination messages\n-  - Check for FYI messages\n-  - See what other agents are doing\n\n## Success Criteria\n\n- OpenCode can call MCP Agent Mail tools\n- File reservations prevent conflicts\n- Agent workflow documented\n\n## Parent\n\nBlocked by: Install pre-commit guards\n\n---\nHuly Issue: MXSYN-53","created_at":"2025-12-26T18:45:15Z"}]}
{"id":"matrix-synapse-deployment-5wcc","title":"Implement: REST API Endpoints for Identity Operations","description":"## Task\nAdd FastAPI endpoints for identity CRUD operations and identity-based messaging.\n\n## Endpoints\n- POST/GET/PUT/DELETE /api/v1/identities - CRUD\n- GET /api/v1/identities/by-mxid/{mxid} - Lookup by Matrix ID\n- GET /api/v1/identities/by-agent/{agent_id} - Lookup by Letta agent\n- POST /api/v1/messages/send-as-identity - Send message as identity\n- POST /api/v1/dm-rooms - Create or get DM room\n\n## Deliverables\n- [ ] Extend src/api/app.py with new routes\n- [ ] Pydantic models in src/api/schemas/identity.py\n- [ ] OpenAPI documentation\n- [ ] Integration tests for all endpoints\n\n## Dependencies\n- Identity Manager\n- Identity Storage Service\n- Matrix Client Pool","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-03T11:04:55.026967947-05:00","updated_at":"2026-01-04T00:44:21.891616901Z","labels":["api","implementation"],"dependencies":[{"issue_id":"matrix-synapse-deployment-5wcc","depends_on_id":"matrix-synapse-deployment-b9mm","type":"blocks","created_at":"2026-01-03T11:06:28.410091029-05:00","created_by":"root"},{"issue_id":"matrix-synapse-deployment-5wcc","depends_on_id":"matrix-synapse-deployment-c9me","type":"blocks","created_at":"2026-01-03T11:06:33.57749305-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-6hdy","title":"Add unit tests for matrix-direct audit skip logic","description":"## Context\nThe webhook handler now skips audit messages for matrix-direct conversations (fix in commit 75a6e06).\n\n## Requirements\n- Test that handleRunCompleted() returns matrix_direct_skip when conversation tracker has an active conversation\n- Test that source is correctly identified as 'matrix-direct' vs 'external'\n- Mock the conversation tracker to simulate both scenarios\n\n## Files\n- mcp-servers/matrix-identity-bridge/src/core/letta-webhook-handler.ts\n- mcp-servers/matrix-identity-bridge/tests/webhook-audit-skip.test.ts (new)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T20:43:01.753520801-05:00","updated_at":"2026-01-02T20:43:01.753520801-05:00","labels":["test"]}
{"id":"matrix-synapse-deployment-6q8","title":"Phase 3: Long-Running Operation Support","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:28:05.100019191Z","updated_at":"2026-01-04T01:23:14.491156141Z","closed_at":"2026-01-04T01:23:14.491156141Z","close_reason":"Closed","dependencies":[{"issue_id":"matrix-synapse-deployment-6q8","depends_on_id":"matrix-synapse-deployment-2lx","type":"parent-child","created_at":"2026-01-04T01:08:30.780824266Z","created_by":"unknown"}],"comments":[{"id":33,"issue_id":"matrix-synapse-deployment-6q8","author":"node","text":"Synced from Beads: matrix-synapse-deployment-nqw\n\n---\nHuly Issue: MXSYN-43","created_at":"2025-12-23T03:28:05Z"}]}
{"id":"matrix-synapse-deployment-7hq","title":"Integrate MCP Agent Mail with Letta Code","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T18:45:13.331005485Z","updated_at":"2025-12-26T18:45:13.331005485Z","comments":[{"id":45,"issue_id":"matrix-synapse-deployment-7hq","author":"node","text":"Configure Letta Code to use MCP Agent Mail for coordination (note: using Letta Code, not Claude Code).\n\n## Tasks\n\n- Check if Letta Code has MCP integration capabilities\n- If yes: run integration script or manual config\n- If no: use Letta tools from previous issue instead\n- Test file coordination workflow\n- Document Letta Code + MCP Agent Mail setup\n\n## Research Needed\n\n- Does Letta Code support MCP servers?\n- What's the config file location?\n- Is there an integration script?\n\n## Fallback\n\nIf Letta Code doesn't support MCP directly, Letta agents will use the tools from issue MXSYN-XXX (file_reservations.py module)\n\n## Parent\n\nBlocked by: Create Letta file_reservations tool module\n\n---\nHuly Issue: MXSYN-55","created_at":"2025-12-26T18:45:13Z"}]}
{"id":"matrix-synapse-deployment-7n8","title":"Fix 12 Letta agents missing Matrix room mappings","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T08:51:39.86412675Z","updated_at":"2025-12-28T08:51:39.86412675Z","comments":[{"id":49,"issue_id":"matrix-synapse-deployment-7n8","author":"root","text":"## Problem\n\nThe agent room provisioning test discovered 12 Letta agents that don't have Matrix room mappings:\n\n 1. Huly - Huly-Vibe Sync Service (agent-b417b8da-84d2-40dd-97ad-3a35454934f7)\n 2. Test Archival Agent (agent-22273237-8bf9-4a53-8001-fa62aa2469ce)\n 3. Test Archival Agent (agent-36347120-f59c-42fb-bd9a-269b2375f7f2)\n 4. Test Archival Agent (agent-86ec6e54-8fee-4489-abfb-72ba0a3716f4)\n 5. Test Archival Agent (agent-2e3bad24-a040-46ab-af3a-d85496accaca)\n 6. letta-code-agent (agent-22a0d0ec-f156-4738-831b-13bf1cac8bd0)\n 7. letta-cli-agent (agent-64499416-dda3-44a2-8bd8-17193adcc1dc)\n 8. letta-code-agent (agent-06a1cd79-f223-4b38-920a-4f156550123e)\n 9. Meridian-sleeptime (agent-2ee4df6c-59ca-489b-8620-dc53096208ac)\n10. letta-cli-agent (agent-7b751941-abc2-4e23-a0fe-e1e6acd87949)\n11. Huly - Matrix Messaging MCP (agent-ec6b15ef-2f4b-4bae-9ee2-4cea0b22cffd)\n12. letta-cli-agent (agent-5a678a36-64fc-452d-8e7c-d810f21fb15f)\n\n## Impact\n\nWithout room mappings, these agents cannot be reached via  or  operations. The matrix-identity-bridge returns \"no Matrix room configured\" errors.\n\n## Solution\n\nTrigger a manual sync to create rooms for these agents:\n\n\n\nAlternatively, run the provisioning script to create rooms programmatically.\n\n## Verification\n\nRun the test suite:\n\n\n\n---\nHuly Issue: MXSYN-74","created_at":"2025-12-28T08:51:40Z"}]}
{"id":"matrix-synapse-deployment-836","title":"Document Letta Filesystem API for folder/file operations","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-09T19:33:04.900496617Z","updated_at":"2026-01-09T19:33:05.33127961Z","closed_at":"2026-01-09T19:33:05.33127961Z","close_reason":"Closed","comments":[{"id":699,"issue_id":"matrix-synapse-deployment-836","author":"root","text":"## Objective\n\nClarify and document Letta Filesystem API endpoints needed for integration.\n\n## API Endpoints to Document\n\n1. **List folders**: \n2. **Create folder**: \n3. **Upload file to folder**: \n4. **Attach folder to agent**: \n5. **Job status**: \n\n## Questions\n\n- How does file chunking work?\n- What embedding model is used by default?\n- How to pass metadata (source, room_id, sender)?\n- Job polling interval for upload completion?\n\n## Deliverable\n\nCode examples or SDK usage documentation\n\n## Reference\n\n- Letta API: https://letta.oculair.ca\n- PRD folder strategy: One folder per Matrix room ()\n\n---\nHuly Issue: MXSYN-3","created_at":"2026-01-09T19:33:05Z"}]}
{"id":"matrix-synapse-deployment-8sq","title":"Create Letta file_reservations tool module","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T18:45:14.337322327Z","updated_at":"2025-12-26T18:45:14.337322327Z"}
{"id":"matrix-synapse-deployment-8te7","title":"Deprecation: Remove Identity Logic from TypeScript MCP","description":"## Task\nAfter Python identity system is stable, deprecate and remove identity management from TypeScript MCP.\n\n## Prerequisites\n- [ ] Python identity system fully operational\n- [ ] All consumers migrated to Python API\n- [ ] Migration complete\n- [ ] 2 weeks stable production use\n\n## Phases\n\n### Phase 1: Soft Deprecation\n- Add deprecation warnings\n- Log usage of deprecated endpoints\n- Document migration path\n\n### Phase 2: Hard Deprecation\n- Return 410 Gone for identity operations\n- Remove identity tools from MCP schema\n\n### Phase 3: Removal\n- Delete: identity-manager.ts, client-pool.ts, storage.ts (identity parts)\n- Archive JSON data files\n- Update documentation\n\n## Deliverables\n- [ ] Deprecation warnings added\n- [ ] Migration documentation\n- [ ] Dead code removed\n- [ ] MCP schema updated","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T11:05:34.199319062-05:00","updated_at":"2026-01-03T11:05:34.199319062-05:00","labels":["deprecation"],"dependencies":[{"issue_id":"matrix-synapse-deployment-8te7","depends_on_id":"matrix-synapse-deployment-v6rd","type":"blocks","created_at":"2026-01-03T11:07:09.750130896-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-93b","title":"Implement Matrix file download from media repository","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:32.078603173Z","updated_at":"2026-01-03T11:10:02.057994162-05:00","closed_at":"2026-01-03T11:10:02.057994162-05:00","close_reason":"Duplicate of matrix-synapse-deployment-3162","dependencies":[{"issue_id":"matrix-synapse-deployment-93b","depends_on_id":"matrix-synapse-deployment-3162","type":"related","created_at":"2026-01-03T11:10:02.060336942-05:00","created_by":"root"}],"comments":[{"id":21,"issue_id":"matrix-synapse-deployment-93b","author":"node","text":"## Objective\n\nDownload files from Matrix media repository for processing.\n\n## Implementation\n\n1. Convert  URL to HTTP download URL\n2. Download file with proper authentication\n3. Store temporarily for Docling processing\n4. Clean up after processing complete\n\n## API Reference\n\n\n\n## Acceptance Criteria\n\n- [ ] Successfully download files from mxc:// URLs\n- [ ] Handle authentication correctly\n- [ ] Temporary storage with cleanup\n- [ ] Error handling for failed downloads\n\n---\nHuly Issue: MXSYN-5","created_at":"2025-12-23T03:23:32Z"}]}
{"id":"matrix-synapse-deployment-9zx","title":"Phase 2: Integrate Streaming into Matrix Client","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:31.69652089Z","updated_at":"2026-01-03T11:10:03.10827686-05:00","closed_at":"2026-01-03T11:10:03.10827686-05:00","close_reason":"Duplicate of matrix-synapse-deployment-10d2","dependencies":[{"issue_id":"matrix-synapse-deployment-9zx","depends_on_id":"matrix-synapse-deployment-10d2","type":"related","created_at":"2026-01-03T11:10:03.110876217-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-a8a","title":"Document Letta Filesystem API for folder/file operations","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-26T18:43:30.432853114Z","updated_at":"2026-01-04T01:23:12.544218603Z","closed_at":"2026-01-04T01:23:12.544218603Z","close_reason":"Closed","comments":[{"id":37,"issue_id":"matrix-synapse-deployment-a8a","author":"node","text":"## Objective\n\nClarify and document Letta Filesystem API endpoints needed for integration.\n\n## API Endpoints to Document\n\n1. **List folders**: \n2. **Create folder**: \n3. **Upload file to folder**: \n4. **Attach folder to agent**: \n5. **Job status**: \n\n## Questions\n\n- How does file chunking work?\n- What embedding model is used by default?\n- How to pass metadata (source, room_id, sender)?\n- Job polling interval for upload completion?\n\n## Deliverable\n\nCode examples or SDK usage documentation\n\n## Reference\n\n- Letta API: https://letta.oculair.ca\n- PRD folder strategy: One folder per Matrix room ()\n\n---\nHuly Issue: MXSYN-3","created_at":"2025-12-26T18:43:30Z"}]}
{"id":"matrix-synapse-deployment-avm","title":"Implement Letta folder management for Matrix rooms","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:31.688159527Z","updated_at":"2026-01-03T11:10:02.064113384-05:00","closed_at":"2026-01-03T11:10:02.064113384-05:00","close_reason":"Duplicate of matrix-synapse-deployment-4esm","dependencies":[{"issue_id":"matrix-synapse-deployment-avm","depends_on_id":"matrix-synapse-deployment-4esm","type":"related","created_at":"2026-01-03T11:10:02.066229202-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-aykt","title":"Refactor: Webhook Audit to Use Identity-Based Posting","description":"## Task\nRefactor webhook handler to post audit messages using correct Matrix identities.\n\n## Current Behavior\nCombined message from admin account:\nðŸ’¬ [Direct] Q: ... A: ...\n\n## Desired Behavior\nTwo separate messages:\n1. User's question â†’ Posted with source indicator\n2. Agent's response â†’ Posted by agent's Matrix identity (e.g., @meridian:matrix.oculair.ca)\n\n## Implementation\n1. Extract user message from webhook payload\n2. Look up agent's Matrix identity from database\n3. Post user message to audit room\n4. Post agent response using agent's identity via client pool\n\n## Deliverables\n- [ ] Refactor src/letta/webhook_handler.py\n- [ ] Add identity lookup integration\n- [ ] Use Matrix client pool for agent responses\n- [ ] Unit tests for new logic\n\n## Dependencies\n- js5i (Identity Storage Service)\n- c9me (Matrix Client Pool)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-03T11:05:05.644951923-05:00","updated_at":"2026-01-03T11:55:19.894928802-05:00","closed_at":"2026-01-03T11:55:19.894928802-05:00","close_reason":"Closed","labels":["refactor"],"dependencies":[{"issue_id":"matrix-synapse-deployment-aykt","depends_on_id":"matrix-synapse-deployment-js5i","type":"blocks","created_at":"2026-01-03T11:06:49.064384649-05:00","created_by":"root"},{"issue_id":"matrix-synapse-deployment-aykt","depends_on_id":"matrix-synapse-deployment-c9me","type":"blocks","created_at":"2026-01-03T11:06:54.223979452-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-b9mm","title":"Implement: Identity Manager with Synapse Admin API","description":"## Task\nImplement the Identity Manager class that handles user provisioning via Synapse Admin API.\n\n## Requirements\n- Create Matrix users via Synapse Admin API\n- Set display names and avatars\n- Generate and store access tokens\n- Handle user deactivation/reactivation\n\n## API Endpoints Used\n- POST /_synapse/admin/v2/users/{user_id} - Create/update user\n- POST /_synapse/admin/v1/users/{user_id}/login - Get access token\n\n## Reference\nSee TypeScript: mcp-servers/matrix-identity-bridge/src/core/identity-manager.ts\n\n## Deliverables\n- [ ] src/core/identity_manager.py\n- [ ] Synapse Admin API client wrapper\n- [ ] Unit tests with mocked API responses\n\n## Dependencies\n- mybw (Database schema)\n- js5i (Identity Storage Service)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-03T11:04:36.237482838-05:00","updated_at":"2026-01-03T11:04:36.237482838-05:00","labels":["implementation"],"dependencies":[{"issue_id":"matrix-synapse-deployment-b9mm","depends_on_id":"matrix-synapse-deployment-mybw","type":"blocks","created_at":"2026-01-03T11:06:18.084909302-05:00","created_by":"root"},{"issue_id":"matrix-synapse-deployment-b9mm","depends_on_id":"matrix-synapse-deployment-js5i","type":"blocks","created_at":"2026-01-03T11:06:23.24771838-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-c9me","title":"Implement: Matrix Client Pool (Python)","description":"## Task\nCreate a Matrix client pool that manages per-identity Matrix clients for sending messages.\n\n## Requirements\n\n### Module: src/matrix/identity_client.py\n\n```python\nclass MatrixClientPool:\n    async def get_client(self, identity_id: str) -\u003e AsyncClient\n    async def get_client_for_mxid(self, mxid: str) -\u003e AsyncClient\n    async def remove_client(self, identity_id: str) -\u003e None\n    async def send_message(\n        self,\n        identity_id: str,\n        room_id: str,\n        content: str,\n        msgtype: str = 'm.text',\n        reply_to: Optional[str] = None\n    ) -\u003e str  # Returns event_id\n    async def send_reaction(self, identity_id: str, room_id: str, event_id: str, emoji: str) -\u003e str\n    async def set_typing(self, identity_id: str, room_id: str, typing: bool, timeout: int = 30000) -\u003e None\n    async def stop_all(self) -\u003e None\n```\n\n### Client Lifecycle\n1. On first request, create AsyncClient with identity's access token\n2. Start client sync (for receiving events)\n3. Cache client in pool\n4. Handle token refresh if needed\n5. Cleanup on removal or shutdown\n\n### Memory Management\n- Max clients in pool: configurable (default 50)\n- LRU eviction for idle clients\n- Idle timeout: 5 minutes\n- Graceful shutdown stops all clients\n\n### Error Handling\n- Token expired â†’ refresh token â†’ retry\n- Rate limited â†’ exponential backoff\n- Client sync failed â†’ restart client\n- Room not joined â†’ auto-join if possible\n\n## Deliverables\n- [ ] MatrixClientPool class implementation\n- [ ] Per-client state storage (sync tokens)\n- [ ] Token refresh mechanism\n- [ ] Memory management with LRU eviction\n- [ ] Unit tests with mocked Matrix server\n- [ ] Integration tests with real Matrix server\n\n## Acceptance Criteria\n- Clients correctly authenticated per identity\n- Messages sent appear from correct user\n- Pool handles 50+ concurrent identities\n- Memory usage stable under load\n- 90%+ test coverage","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-03T10:57:40.260576419-05:00","updated_at":"2026-01-03T11:35:20.640630949-05:00","closed_at":"2026-01-03T11:35:20.640630949-05:00","close_reason":"Closed","labels":["implementation"]}
{"id":"matrix-synapse-deployment-co8","title":"Implement Matrix file upload event detection","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:33.47566984Z","updated_at":"2025-12-23T03:23:33.923460248Z","closed_at":"2025-12-23T03:23:33.923460248Z","close_reason":"Closed","comments":[{"id":692,"issue_id":"matrix-synapse-deployment-co8","author":"node","text":"## Objective\n\nDetect file upload events in Matrix rooms and trigger processing pipeline.\n\n## Implementation\n\n1. Monitor  events with \n2. Extract file metadata:\n   -  (mxc:// URL)\n   - \n   -  (mimetype)\n   - \n   - \n   - \n   - \n3. Filter by supported file types: \n4. Filter by max size: 50MB\n\n## Location\n\n\n\n## Acceptance Criteria\n\n- [ ] File uploads detected in real-time\n- [ ] Metadata extracted correctly\n- [ ] Unsupported files ignored with optional notification\n- [ ] Large files rejected with user notification\n\n---\nHuly Issue: MXSYN-4","created_at":"2026-01-04T01:06:13Z"}]}
{"id":"matrix-synapse-deployment-coo","title":"Document Letta Filesystem API for folder/file operations","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-09T19:30:27.516729772Z","updated_at":"2026-01-09T19:30:27.882433504Z","closed_at":"2026-01-09T19:30:27.882433504Z","close_reason":"Closed","comments":[{"id":698,"issue_id":"matrix-synapse-deployment-coo","author":"root","text":"## Objective\n\nClarify and document Letta Filesystem API endpoints needed for integration.\n\n## API Endpoints to Document\n\n1. **List folders**: \n2. **Create folder**: \n3. **Upload file to folder**: \n4. **Attach folder to agent**: \n5. **Job status**: \n\n## Questions\n\n- How does file chunking work?\n- What embedding model is used by default?\n- How to pass metadata (source, room_id, sender)?\n- Job polling interval for upload completion?\n\n## Deliverable\n\nCode examples or SDK usage documentation\n\n## Reference\n\n- Letta API: https://letta.oculair.ca\n- PRD folder strategy: One folder per Matrix room ()\n\n---\nHuly Issue: MXSYN-3","created_at":"2026-01-09T19:30:27Z"}]}
{"id":"matrix-synapse-deployment-e2c","title":"Add agent health check to detect stuck approval states","description":"The Houdini MCP agent became unresponsive because it had pending tool approvals that were never processed. The periodic agent sync doesn't detect this state.\n\nProblem:\n- Agent has pending approval_request_message blocking all new messages\n- Matrix bridge keeps forwarding messages but gets CONFLICT errors\n- No automatic recovery - requires manual API call to approve/deny\n\nSolution options:\n1. Add health check in periodic sync to detect agents with pending approvals\n2. Auto-approve or auto-deny stale approval requests (configurable timeout)\n3. Send notification to Matrix when agent is blocked by pending approval\n4. Add /approve and /deny commands to Matrix for manual resolution\n\nRelated: The streaming module now parses approval_request_message but doesn't send approval responses back to Letta yet.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T12:58:08.00041429-05:00","updated_at":"2025-12-28T12:58:08.00041429-05:00"}
{"id":"matrix-synapse-deployment-go8x","title":"Phase 1: Add webhook endpoint to matrix-identity-bridge","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T16:33:00.341865588Z","updated_at":"2026-01-02T16:33:00.341865588Z","dependencies":[{"issue_id":"matrix-synapse-deployment-go8x","depends_on_id":"matrix-synapse-deployment-lg0a","type":"parent-child","created_at":"2026-01-02T16:33:00.700902884Z","created_by":"unknown"}],"comments":[{"id":366,"issue_id":"matrix-synapse-deployment-go8x","author":"root","text":"Create  endpoint in \n\n- Extract agent_id and messages from payload\n- Look up Matrix room for agent\n- Post response to Matrix room\n- Implement HMAC signature verification\n\n---\nHuly Issue: MXSYN-93","created_at":"2026-01-02T16:33:00Z"}]}
{"id":"matrix-synapse-deployment-gp8","title":"Agent Mail Reverse Bridge: Handle edge cases","description":"## Overview\nHandle edge cases and failure scenarios in the reverse bridge.\n\n## Edge Cases\n1. **Agent sends multiple messages** - Forward all or just first?\n2. **Agent uses tool calls** - Forward tool results or just final response?\n3. **Agent mentions other users** - Preserve mentions?\n4. **Message contains attachments/images** - Forward or skip?\n5. **Rate limiting** - Don't spam Agent Mail\n6. **Duplicate detection** - Don't forward same response twice\n\n## Failure Handling\n- Agent Mail API unavailable â†’ queue and retry\n- Invalid code name mapping â†’ log error, skip\n- Thread_id missing â†’ create new thread or skip?\n\n## Acceptance Criteria\n- [ ] Multi-message responses handled appropriately\n- [ ] Duplicates prevented\n- [ ] Failures logged and recoverable\n- [ ] Rate limiting in place","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-25T11:45:03.655302068-05:00","updated_at":"2025-12-26T18:48:53.979591897Z","dependencies":[{"issue_id":"matrix-synapse-deployment-gp8","depends_on_id":"matrix-synapse-deployment-ny7","type":"blocks","created_at":"2025-12-25T11:45:38.288079655-05:00","created_by":"daemon"}]}
{"id":"matrix-synapse-deployment-jbk","title":"Agent Mail Bidirectional Bridge: Architecture decision","description":"## Overview\nDecide where the reverse bridge logic should live.\n\n## Options\n\n### Option A: Extend existing agent_mail_bridge.py\n- Add Matrix listener alongside Agent Mail poller\n- Single container, shared state\n- Simpler deployment\n- Risk: complexity in one service\n\n### Option B: Separate reverse bridge service\n- New container: agent_mail_reverse_bridge\n- Subscribes to Matrix events\n- Calls Agent Mail API independently\n- Cleaner separation of concerns\n- More containers to manage\n\n### Option C: Add to matrix-client\n- matrix-client already processes agent responses\n- Add hook after agent response sent to Matrix\n- Check if original was from bridge, forward if so\n- Least new code, leverages existing flow\n\n## Recommendation\nOption C seems cleanest - matrix-client already has the context.\n\n## Decision Needed\n- [ ] Choose architecture approach\n- [ ] Document rationale","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T11:45:15.322139603-05:00","updated_at":"2025-12-26T18:48:54.69565826Z"}
{"id":"matrix-synapse-deployment-js5i","title":"Implement: Identity Storage Service (Python)","description":"## Task\nCreate the identity storage service that provides CRUD operations for identities.\n\n## Requirements\n\n### Module: src/core/identity_storage.py\n\n```python\nclass IdentityStorage:\n    async def create_identity(self, identity: IdentityCreate) -\u003e Identity\n    async def get_identity(self, identity_id: str) -\u003e Optional[Identity]\n    async def get_identity_by_mxid(self, mxid: str) -\u003e Optional[Identity]\n    async def list_identities(self, type: Optional[str] = None) -\u003e List[Identity]\n    async def update_identity(self, identity_id: str, updates: IdentityUpdate) -\u003e Identity\n    async def delete_identity(self, identity_id: str) -\u003e bool\n    async def touch_identity(self, identity_id: str) -\u003e None  # Update last_used_at\n```\n\n### Features\n- Database-backed with SQLAlchemy async\n- Caching layer for frequent lookups\n- Cache invalidation on writes\n- Bulk operations support\n- Soft delete (is_active flag)\n\n### Caching Strategy\n- LRU cache for identity lookups\n- TTL: 5 minutes for individual identities\n- Invalidate on any write operation\n- Optional Redis backend for distributed caching\n\n## Deliverables\n- [ ] IdentityStorage class implementation\n- [ ] Pydantic models for Identity, IdentityCreate, IdentityUpdate\n- [ ] Cache implementation with invalidation\n- [ ] Unit tests with mocked database\n- [ ] Integration tests with real database\n\n## Acceptance Criteria\n- All CRUD operations work correctly\n- Cache hit rate \u003e 80% for read operations\n- Handles concurrent access safely\n- 95%+ test coverage","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-03T10:57:15.910871502-05:00","updated_at":"2026-01-03T11:31:35.733893053-05:00","closed_at":"2026-01-03T11:31:35.733893053-05:00","close_reason":"Closed","labels":["implementation"]}
{"id":"matrix-synapse-deployment-kev","title":"Install pre-commit guards for file reservations","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T18:45:15.671290989Z","updated_at":"2025-12-26T18:45:15.671290989Z","comments":[{"id":47,"issue_id":"matrix-synapse-deployment-kev","author":"node","text":"Install Git pre-commit hooks to enforce file reservations and prevent conflicts.\n\n## Tasks\n\n- Install guard for matrix-synapse-deployment repo\n- Test blocking behavior with mock reservations\n- Document guard functionality\n- Create troubleshooting guide\n\n## Command\n\n\n\n## Success Criteria\n\n- Pre-commit hook blocks commits to reserved files\n- Hook allows commits to unreserved files\n- Clear error messages when blocked\n\n## Parent\n\nBlocked by: Configure MCP Agent Mail\n\n---\nHuly Issue: MXSYN-52","created_at":"2025-12-26T18:45:15Z"}]}
{"id":"matrix-synapse-deployment-kpm","title":"Document MCP Agent Mail integration and workflows","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T18:45:12.557064562Z","updated_at":"2025-12-26T18:45:12.557064562Z","comments":[{"id":44,"issue_id":"matrix-synapse-deployment-kpm","author":"node","text":"Create comprehensive documentation for the three-layer architecture.\n\n## Documentation Tasks\n\n1. Update AGENTS.md with MCP Agent Mail instructions\n2. Create architecture diagram (Layer 1: Matrix, Layer 2: MCP Agent Mail, Layer 3: Huly)\n3. Write agent onboarding guide\n4. Document file reservation workflow\n5. Create troubleshooting guide\n6. Add examples to README\n\n## Files to Create/Update\n\n-  - Three-layer overview\n-  - How to use reservations\n-  - Add MCP Agent Mail section\n-  - Update with Layer 2 info\n\n## Examples to Include\n\n- OpenCode agent reserving files\n- Letta agent checking for conflicts\n- Multi-agent refactoring workflow\n- Pre-commit guard blocking conflict\n\n## Success Criteria\n\n- New agents can onboard using docs\n- Common issues documented with solutions\n- Architecture clearly explained\n\n## Parent\n\nBlocked by: Create Matrix notification helpers\n\n---\nHuly Issue: MXSYN-58","created_at":"2025-12-26T18:45:12Z"}]}
{"id":"matrix-synapse-deployment-kqz","title":"Add dev mode with auto-reload for matrix-client","description":"After code changes to src/, the matrix-client container needs to be restarted to pick up changes. The source is volume-mounted but Python caches modules.\n\nOptions:\n1. Use watchfiles (already installed) to auto-restart on file changes\n2. Add a dev docker-compose override with watchfiles entrypoint\n3. Create a simple restart script to run after commits\n\nQuick fix for now: docker restart matrix-synapse-deployment-matrix-client-1","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T12:50:51.240605877-05:00","updated_at":"2025-12-28T12:50:51.240605877-05:00"}
{"id":"matrix-synapse-deployment-kr2n","title":"Implement: DM Room Management Service","description":"## Task\nImplement DM (Direct Message) room management for identity-based messaging.\n\n## Core Functionality\n- Create DM rooms between two Matrix users\n- Cache room lookups to avoid redundant API calls\n- Support identity-to-identity and identity-to-external-user DMs\n\n## Reference\nSee TypeScript: mcp-servers/matrix-identity-bridge/src/core/storage.ts (getDMRoom, setDMRoom)\n\n## Deliverables\n- [ ] src/matrix/dm_room_service.py\n- [ ] Database operations for dm_rooms table\n- [ ] Unit and integration tests\n\n## Dependencies\n- mybw (Database schema with dm_rooms table)\n- c9me (Matrix Client Pool)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-03T11:04:59.264619563-05:00","updated_at":"2026-01-03T11:04:59.264619563-05:00","labels":["implementation"],"dependencies":[{"issue_id":"matrix-synapse-deployment-kr2n","depends_on_id":"matrix-synapse-deployment-mybw","type":"blocks","created_at":"2026-01-03T11:06:38.734208967-05:00","created_by":"root"},{"issue_id":"matrix-synapse-deployment-kr2n","depends_on_id":"matrix-synapse-deployment-c9me","type":"blocks","created_at":"2026-01-03T11:06:43.897619076-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-kwlc","title":"Migration: Import Existing Identities from JSON to PostgreSQL","description":"## Task\nCreate migration script to import identities from TypeScript JSON files to PostgreSQL.\n\n## Source Data\n- identities.json: mcp-servers/matrix-identity-bridge/data/identities.json\n- dm_rooms.json: mcp-servers/matrix-identity-bridge/data/dm_rooms.json\n\n## Script Requirements\n1. Read JSON files from TypeScript data directory\n2. Validate data integrity\n3. Transform to PostgreSQL schema format\n4. Insert into database with error handling\n5. Verify migration success\n\n## Deliverables\n- [ ] scripts/migration/migrate_identities.py\n- [ ] Rollback script\n- [ ] Migration verification report\n\n## Risks\n- Access tokens may be expired\n- Duplicate identities across systems","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T11:05:22.95643854-05:00","updated_at":"2026-01-03T11:05:22.95643854-05:00","labels":["migration"],"dependencies":[{"issue_id":"matrix-synapse-deployment-kwlc","depends_on_id":"matrix-synapse-deployment-mybw","type":"blocks","created_at":"2026-01-03T11:06:59.385124951-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-lg0a","title":"Replace ResponseMonitor Polling with Letta Webhooks","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T16:26:31.820445441Z","updated_at":"2026-01-02T16:26:31.820445441Z","comments":[{"id":363,"issue_id":"matrix-synapse-deployment-lg0a","author":"root","text":"## Problem\n\nThe  in  polls Letta every 2 seconds for up to 60 seconds to detect agent responses. This is inefficient:\n\n- ~30 API calls per active conversation\n- Up to 2 second latency before response detection\n- Doesn't scale - polling overhead increases with concurrent conversations\n\n## Solution\n\nLeverage new Letta webhooks ( with messages payload) to replace polling with push notifications.\n\n## Benefits\n\n- API calls: ~30 â†’ 1 per conversation\n- Latency: 0-2 sec â†’ instant\n- Better scalability and simpler code\n\n---\nHuly Issue: MXSYN-92","created_at":"2026-01-02T16:26:32Z"},{"id":447,"issue_id":"matrix-synapse-deployment-lg0a","author":"root","text":"## Bug Fix: Webhook Message Truncation (2026-01-02)\n\n### Problem\nMessages from Letta agents via CLI/API were being severely truncated when posted to Matrix rooms. Instead of full responses, only fragments like `\":\"`, `\"'s happening:\"` appeared.\n\n**Root Cause:** The `extractAssistantContent()` function in `letta-webhook-handler.ts` only handled string content. Letta v1 agents send content in array format:\n```json\n{\"content\": [{\"type\": \"text\", \"text\": \"actual message\"}]}\n```\n\nThe old code fell back to `JSON.stringify()` which produced truncated output.\n\n### Fix Applied\n1. **`letta-webhook-handler.ts`** - Added `extractContentText()` method that properly handles:\n   - String content (direct return)\n   - Array of content parts (extracts `{type: \"text\", text: \"...\"}` entries)\n   - Object with `text` field\n   - Fallback with warning for unknown formats\n\n2. **`webhook-server.ts`** - Improved debug logging to show content type and preview\n\n3. **`tests/webhook-content-extraction.test.ts`** - 25 unit tests covering all content formats and regression tests\n\n### Verification\n- Before: `content length: 1, preview: \":\"`\n- After: `content length: 108, preview: \"Hello! ðŸ‘‹ I received your webhook test message...\"`\n\nAll 25 tests pass. Fix deployed and verified with live webhook.","created_at":"2026-01-02T18:51:33Z"}]}
{"id":"matrix-synapse-deployment-lxyh","title":"Add integration test for duplicate prevention flow","description":"## Context\nEnd-to-end test for the full duplicate prevention flow.\n\n## Requirements\n- Test registration endpoint receives conversation tracking request\n- Test webhook handler checks conversation tracker\n- Test that matrix-direct conversations skip audit\n- Test that external sources get audit posted\n\n## Flow to test\n1. POST /conversations/register with agent_id\n2. POST /webhooks/letta/agent-response with same agent_id\n3. Verify response indicates skip (matrix_direct_skip)\n4. POST /webhooks/letta/agent-response with different agent_id (no registration)\n5. Verify audit was posted\n\n## Files\n- mcp-servers/matrix-identity-bridge/tests/webhook-duplicate-prevention.integration.test.ts (new)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T20:43:06.260084106-05:00","updated_at":"2026-01-02T20:43:06.260084106-05:00","labels":["test"]}
{"id":"matrix-synapse-deployment-lzq","title":"Document Letta Filesystem API for folder/file operations","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-09T19:28:55.06715897Z","updated_at":"2026-01-09T19:28:55.535060064Z","closed_at":"2026-01-09T19:28:55.535060064Z","close_reason":"Closed","comments":[{"id":697,"issue_id":"matrix-synapse-deployment-lzq","author":"root","text":"## Objective\n\nClarify and document Letta Filesystem API endpoints needed for integration.\n\n## API Endpoints to Document\n\n1. **List folders**: \n2. **Create folder**: \n3. **Upload file to folder**: \n4. **Attach folder to agent**: \n5. **Job status**: \n\n## Questions\n\n- How does file chunking work?\n- What embedding model is used by default?\n- How to pass metadata (source, room_id, sender)?\n- Job polling interval for upload completion?\n\n## Deliverable\n\nCode examples or SDK usage documentation\n\n## Reference\n\n- Letta API: https://letta.oculair.ca\n- PRD folder strategy: One folder per Matrix room ()\n\n---\nHuly Issue: MXSYN-3","created_at":"2026-01-09T19:28:55Z"}]}
{"id":"matrix-synapse-deployment-m4k","title":"Agent Mail Reverse Bridge: Track bridge-originated messages","description":"## Overview\nTrack which Matrix messages originated from the Agent Mail bridge so we can identify when agents respond to them.\n\n## Requirements\n- When bridge sends a message to Matrix, store metadata mapping:\n  - Matrix event_id â†’ Agent Mail message_id\n  - Matrix room_id â†’ Agent Mail recipient (code name)\n  - Original sender (code name)\n- Storage options: in-memory dict, SQLite, or Redis\n- Must survive bridge restarts (persistent storage preferred)\n\n## Acceptance Criteria\n- [ ] Bridge stores mapping when forwarding messages\n- [ ] Mapping includes: matrix_event_id, agent_mail_msg_id, sender, recipient, thread_id\n- [ ] Mapping persists across restarts","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T11:44:36.028601979-05:00","updated_at":"2025-12-26T18:48:54.152449747Z"}
{"id":"matrix-synapse-deployment-mybw","title":"Design: Python Identity Management Database Schema","description":"## Task\nDesign and implement SQLAlchemy models for identity management.\n\n## Requirements\n\n### New Tables\n\n**identities**\n```sql\nCREATE TABLE identities (\n    id VARCHAR(255) PRIMARY KEY,           -- e.g., letta_agent-xxx, opencode_v2_xxx\n    identity_type VARCHAR(50) NOT NULL,    -- letta, opencode, custom\n    mxid VARCHAR(255) UNIQUE NOT NULL,     -- @user:domain\n    display_name VARCHAR(255),\n    avatar_url VARCHAR(500),               -- mxc:// URL\n    access_token TEXT NOT NULL,            -- Matrix access token\n    password_hash TEXT,                    -- For recovery/re-login\n    device_id VARCHAR(255),                -- Matrix device ID\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW(),\n    last_used_at TIMESTAMP,\n    is_active BOOLEAN DEFAULT TRUE\n);\n\nCREATE INDEX idx_identities_type ON identities(identity_type);\nCREATE INDEX idx_identities_mxid ON identities(mxid);\n```\n\n**dm_rooms**\n```sql\nCREATE TABLE dm_rooms (\n    id SERIAL PRIMARY KEY,\n    room_id VARCHAR(255) UNIQUE NOT NULL,\n    participant_1 VARCHAR(255) NOT NULL,   -- Sorted MXIDs\n    participant_2 VARCHAR(255) NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    last_activity_at TIMESTAMP,\n    UNIQUE(participant_1, participant_2)\n);\n\nCREATE INDEX idx_dm_rooms_participants ON dm_rooms(participant_1, participant_2);\n```\n\n### Relationships\n- identities.mxid can be referenced by agent_mappings.matrix_user_id\n- dm_rooms links two MXIDs (identities or external users)\n\n## Deliverables\n- [ ] SQLAlchemy models in src/models/identity.py\n- [ ] Alembic migration script\n- [ ] Unit tests for model operations\n- [ ] Documentation of schema\n\n## Acceptance Criteria\n- Models match TypeScript data structure\n- Migration runs without data loss\n- Indexes optimized for common queries\n- Tests cover all CRUD operations","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-03T10:56:53.85876522-05:00","updated_at":"2026-01-03T11:28:04.490310037-05:00","closed_at":"2026-01-03T11:28:04.490310037-05:00","close_reason":"Closed","labels":["database","design"]}
{"id":"matrix-synapse-deployment-mzai","title":"Refactor webhook content extraction from MCP to letta-matrix-client","description":"## Background\n\nThe webhook content extraction logic (handling Letta v1 array format `[{type: 'text', text: '...'}]`) is currently in the MCP server (`matrix-identity-bridge`). This is architecturally incorrect - the MCP server should be a tool interface, not handle incoming webhooks from external services.\n\n## Current Location\n- `mcp-servers/matrix-identity-bridge/src/core/letta-webhook-handler.ts`\n- `mcp-servers/matrix-identity-bridge/src/core/webhook-server.ts`\n\n## Target Location\n- `src/letta/letta_matrix_client.py` or similar bridge component\n\n## Changes Required\n1. Move `extractContentText()` logic to Python in the client\n2. Move webhook endpoint handling to the bridge/client\n3. Keep MCP server focused on Matrix messaging operations only\n\n## Content Extraction Logic (for reference)\n```python\ndef extract_content_text(content) -\u003e str | None:\n    if not content:\n        return None\n    if isinstance(content, str):\n        return content\n    if isinstance(content, list):\n        text_parts = []\n        for part in content:\n            if isinstance(part, dict) and part.get('type') == 'text' and isinstance(part.get('text'), str):\n                text_parts.append(part['text'])\n        return '\\n'.join(text_parts) if text_parts else None\n    if isinstance(content, dict) and isinstance(content.get('text'), str):\n        return content['text']\n    return json.dumps(content)\n```","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-02T15:39:37.280934845-05:00","updated_at":"2026-01-03T01:50:32.878846429Z"}
{"id":"matrix-synapse-deployment-nel","title":"Phase 1: Implement Step Streaming Adapter","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:28.561096028Z","updated_at":"2026-01-03T11:10:02.428508107-05:00","closed_at":"2026-01-03T11:10:02.428508107-05:00","close_reason":"Duplicate of matrix-synapse-deployment-10nf","dependencies":[{"issue_id":"matrix-synapse-deployment-nel","depends_on_id":"matrix-synapse-deployment-10nf","type":"related","created_at":"2026-01-03T11:10:02.430946278-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-nqvz","title":"Phase 4: Multi-agent webhook management","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T16:26:30.968074932Z","updated_at":"2026-01-02T16:26:30.968074932Z","dependencies":[{"issue_id":"matrix-synapse-deployment-nqvz","depends_on_id":"matrix-synapse-deployment-lg0a","type":"parent-child","created_at":"2026-01-02T16:28:54.905477916Z","created_by":"unknown"}],"comments":[{"id":362,"issue_id":"matrix-synapse-deployment-nqvz","author":"root","text":"Create utility to:\n- List agents with/without webhooks configured\n- Bulk register webhooks for all Matrix-connected agents\n- Handle webhook secret rotation\n\n---\nHuly Issue: MXSYN-96","created_at":"2026-01-02T16:26:31Z"}]}
{"id":"matrix-synapse-deployment-ny7","title":"Agent Mail Reverse Bridge: Forward replies back to Agent Mail","description":"## Overview\nWhen an agent responds to a bridge message, forward that response back to Agent Mail as a reply.\n\n## Requirements\n- Use Agent Mail `reply_message` API to maintain thread\n- Map Matrix user back to Agent Mail code name\n- Include original context in the reply\n\n## Message Mapping\n- Matrix agent user (@agent_xxx) â†’ Agent Mail code name (WhiteStone, etc)\n- Use existing agent_mail_mappings.json or agent_user_mappings.json\n\n## Reply Format\n- Preserve the agent's response text\n- Include metadata: responded via Matrix, timestamp\n- Maintain thread_id from original message\n\n## Acceptance Criteria\n- [ ] Agent responses forwarded to Agent Mail via reply_message\n- [ ] Thread continuity maintained\n- [ ] Sender correctly mapped to Agent Mail identity\n- [ ] Original sender receives notification","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T11:44:54.558669223-05:00","updated_at":"2025-12-26T18:48:54.520182307Z","dependencies":[{"issue_id":"matrix-synapse-deployment-ny7","depends_on_id":"matrix-synapse-deployment-t5t","type":"blocks","created_at":"2025-12-25T11:45:38.237330223-05:00","created_by":"daemon"}]}
{"id":"matrix-synapse-deployment-qjb","title":"Document Letta Filesystem API for folder/file operations","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-09T19:27:26.781433023Z","updated_at":"2026-01-09T19:27:27.165967355Z","closed_at":"2026-01-09T19:27:27.165967355Z","close_reason":"Closed","comments":[{"id":696,"issue_id":"matrix-synapse-deployment-qjb","author":"root","text":"## Objective\n\nClarify and document Letta Filesystem API endpoints needed for integration.\n\n## API Endpoints to Document\n\n1. **List folders**: \n2. **Create folder**: \n3. **Upload file to folder**: \n4. **Attach folder to agent**: \n5. **Job status**: \n\n## Questions\n\n- How does file chunking work?\n- What embedding model is used by default?\n- How to pass metadata (source, room_id, sender)?\n- Job polling interval for upload completion?\n\n## Deliverable\n\nCode examples or SDK usage documentation\n\n## Reference\n\n- Letta API: https://letta.oculair.ca\n- PRD folder strategy: One folder per Matrix room ()\n\n---\nHuly Issue: MXSYN-3","created_at":"2026-01-09T19:27:26Z"}]}
{"id":"matrix-synapse-deployment-r7e","title":"Configure MCP Agent Mail for coordination-only mode","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T18:45:16.451225956Z","updated_at":"2025-12-26T18:45:16.451225956Z","comments":[{"id":48,"issue_id":"matrix-synapse-deployment-r7e","author":"node","text":"Configure MCP Agent Mail to focus on file coordination, not messaging (Matrix handles that).\n\n## Configuration\n\n\n\n## Tasks\n\n- Update .env with coordination settings\n- Restart container with new config\n- Verify settings via health endpoint\n- Create first test project\n- Test file reservation API\n\n## Parent\n\nBlocked by: Deploy MCP Agent Mail server\n\n---\nHuly Issue: MXSYN-50","created_at":"2025-12-26T18:45:16Z"}]}
{"id":"matrix-synapse-deployment-rq6s","title":"Phase 2: Register webhooks for Matrix agents","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T16:32:56.751853619Z","updated_at":"2026-01-02T16:32:56.751853619Z","dependencies":[{"issue_id":"matrix-synapse-deployment-rq6s","depends_on_id":"matrix-synapse-deployment-lg0a","type":"parent-child","created_at":"2026-01-02T16:32:57.091590732Z","created_by":"unknown"}],"comments":[{"id":365,"issue_id":"matrix-synapse-deployment-rq6s","author":"root","text":"For each agent with Matrix room mapping:\n1. Register webhook for  event\n2. Point to webhook endpoint\n3. Configure HMAC secret for verification\n\n---\nHuly Issue: MXSYN-94","created_at":"2026-01-02T16:32:56Z"}]}
{"id":"matrix-synapse-deployment-t5t","title":"Agent Mail Reverse Bridge: Detect agent replies to bridge messages","description":"## Overview\nDetect when a Letta agent responds to a message that came from the Agent Mail bridge.\n\n## Requirements\n- Monitor Matrix rooms for messages from Letta agents\n- Check if the message is a reply (m.relates_to.m.in_reply_to)\n- Look up the replied-to event_id in the bridge tracking store\n- If found, this is a response that needs to be forwarded back\n\n## Detection Logic\n1. Agent posts message in room\n2. Check if message has reply_to event_id\n3. Query tracking store for that event_id\n4. If match found â†’ trigger reverse forward\n\n## Acceptance Criteria\n- [ ] Detect agent replies to bridge messages\n- [ ] Handle both direct replies and thread replies\n- [ ] Ignore agent messages that aren't replies to bridge messages","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T11:44:45.993798812-05:00","updated_at":"2025-12-26T18:48:54.354105777Z","dependencies":[{"issue_id":"matrix-synapse-deployment-t5t","depends_on_id":"matrix-synapse-deployment-m4k","type":"blocks","created_at":"2025-12-25T11:45:38.181935847-05:00","created_by":"daemon"}]}
{"id":"matrix-synapse-deployment-tbk","title":"Houdini MCP room missing matrix-client bot","description":"The Houdini MCP agent room (!TctV8CNuX9S0Q0OyQh:matrix.oculair.ca) is missing @oc_matrix_synapse_deployment:matrix.oculair.ca which is needed to forward messages to Letta. Compare to Meridian room which has this user. Need to invite the bot to the room.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T12:10:26.544770679-05:00","updated_at":"2025-12-28T18:27:47.428714593Z"}
{"id":"matrix-synapse-deployment-tgr","title":"Investigate why agent sync misses some Letta agents","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-28T08:52:02.61596291Z","updated_at":"2025-12-28T08:52:02.61596291Z"}
{"id":"matrix-synapse-deployment-ttd1","title":"Epic: Migrate Identity Management from TypeScript to Python","description":"## Overview\nRefactor the identity management and message routing logic from the TypeScript MCP (matrix-identity-bridge) into the Python matrix-api service. This centralizes identity operations and exposes them as a REST API that other services can consume.\n\n## Goals\n1. Single source of truth for identity management in Python\n2. REST API for all identity operations\n3. Proper database-backed storage (PostgreSQL)\n4. Matrix client pool for identity-based message sending\n5. Comprehensive test coverage (unit + integration)\n6. Backward compatibility during transition\n\n## Current State (TypeScript)\n- JSON file storage (identities.json, dm_rooms.json)\n- @vector-im/matrix-bot-sdk for Matrix clients\n- Per-identity client pool with caching\n- Synapse Admin API integration for user provisioning\n- Identity types: letta, opencode, custom\n\n## Target State (Python)\n- PostgreSQL database with SQLAlchemy ORM\n- matrix-nio for Matrix clients\n- FastAPI REST endpoints\n- Shared with existing agent_mapping tables\n- Same identity types + extensible\n\n## Success Criteria\n- [ ] All identity CRUD operations work via Python API\n- [ ] Messages can be sent AS specific identities\n- [ ] Webhook audit posts use correct agent identity\n- [ ] 90%+ test coverage on new code\n- [ ] TypeScript MCP can be deprecated for identity ops\n\n## Dependencies\n- PostgreSQL database access\n- Matrix homeserver (Tuwunel)\n- Synapse Admin API token\n- matrix-nio library\n\n## Risks\n- Data migration from JSON to PostgreSQL\n- Access token refresh handling\n- Client pool memory management\n- Breaking changes to MCP consumers","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-03T10:56:28.139583653-05:00","updated_at":"2026-01-03T10:56:28.139583653-05:00","labels":["epic","refactor"]}
{"id":"matrix-synapse-deployment-v6rd","title":"Testing: Comprehensive Test Suite for Identity System","description":"## Task\nCreate comprehensive unit and integration tests for Python identity system. Target: 90%+ coverage.\n\n## Unit Tests\n- Identity Storage Service (CRUD operations)\n- Identity Manager (Synapse Admin API)\n- Matrix Client Pool (caching, refresh)\n- DM Room Service (create, lookup)\n\n## Integration Tests\n- API endpoint lifecycle tests\n- Send message as identity flow\n- Error response handling\n\n## End-to-End\n- Create identity â†’ send message â†’ verify in Matrix\n- Webhook â†’ posts with correct identity\n\n## Deliverables\n- [ ] tests/unit/test_identity_storage.py\n- [ ] tests/unit/test_identity_manager.py\n- [ ] tests/unit/test_client_pool.py\n- [ ] tests/unit/test_dm_room_service.py\n- [ ] tests/integration/test_identity_api.py\n- [ ] Coverage report showing 90%+","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T11:05:28.179741762-05:00","updated_at":"2026-01-03T11:05:28.179741762-05:00","labels":["test"],"dependencies":[{"issue_id":"matrix-synapse-deployment-v6rd","depends_on_id":"matrix-synapse-deployment-5wcc","type":"blocks","created_at":"2026-01-03T11:07:04.545106509-05:00","created_by":"root"}]}
{"id":"matrix-synapse-deployment-vg1","title":"Add streaming support for approval_request_message","description":"The streaming.py module doesn't handle approval_request_message types from Letta. When an agent requires tool approval, this message type is ignored (logged as 'Unknown message type'). Need to:\n1. Add handling for approval_request_message in _parse_chunk() - DONE in this session\n2. Display approval requests in Matrix room so users/OpenCode can see what needs approval\n3. Implement a way to send approval responses back to Letta via Matrix commands (e.g., /approve, /deny)\n4. Test with agents that have tools requiring approval (like Houdini MCP with Bash tool)\n\nPartial implementation committed in streaming.py but not tested yet.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-28T12:10:41.266274726-05:00","updated_at":"2025-12-28T12:16:30.285514964-05:00"}
